(function(a){Object.keys=Object.keys||function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if(typeof e!="object"&&typeof e!="function"||e===null)throw new TypeError("Object.keys called on a non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;h<d;h++)a.call(e,c[h])&&f.push(c[h]);return f}}();var b=b||{};b.MultiselectController={init:function(c){var d=a(this),e=a('<div class="multiselect-trigger-container" />'),f=a('<div class="multiselect-dropdown-container" />'),g=a('<div class="multiselect-action-container" />'),h=a("<ul />"),i=a('<input type="text" class="searchInput" />'),j=a('<a href="javascript:void(0)" class="multiselect-checkall-link">Check All</a>'),k=a('<a href="javascript:void(0)" class="multiselect-uncheckall-link">Uncheck All</a>');g.append(i,j,k),f.append(g,h),d.append(e,f);if(c&&c.items){if(typeof c.items!="object")throw"Nextt Multiselect - Invalid initialization params - items should be a map";var l=Object.keys(c.items),m=b.MultiselectController._nextItem(c,l);h.data("options",c),h.data("nextItem",m),h.data("keyList",l),h.data("originalKeyList",l),h.append(b.MultiselectController._render(0,l,c))}else h.append('<li class="multiselect-empty-msg">No items to show</li>');var n=a('<span class="nr-items" />');c&&c.checked?n.html(c.checked.length):n.html("0");var o=a('<span class="items-selected" />').append(n).append(" selected");e.append(o),h.delegate(":checkbox","change",b.MultiselectController._refresh),h.bind("scroll",b.MultiselectController._scroll),i.bind("keyup",b.MultiselectController._search),j.bind("click",b.MultiselectController._checkAll),k.bind("click",b.MultiselectController._uncheckAll)},_scroll:function(){var c=a(this);if(c[0].scrollHeight-c.scrollTop()>500)return;var d=c.data("nextItem"),e=c.data("options"),f=c.data("keyList");if(e&&e.limit&&d<f.length){var g=d+e.limit,h=b.MultiselectController._render(d,f,e);c.append(h),c.data("nextItem",g)}},_render:function(b,c,d){var e=null,f=c.length-b;d.limit?e=d.limit>f?f:d.limit:e=c.length;var g="";for(var h=b;h<b+e;h++){var i="";a.inArray(c[h],d.checked)>=0&&(i=' checked="checked"'),g+='<li><label><input type="checkbox" value="'+c[h]+'" '+i+"/>"+d.items[c[h]]+"</label></li>"}return g},_search:function(){var c=a(this).parent().siblings("ul"),d=c.data("options"),e=a(this).val(),f=new RegExp(e,"i"),g=a.map(d.items,function(a,b){if(f.test(a))return b}),h=b.MultiselectController._render(0,g,d),i=b.MultiselectController._nextItem(d,g);c.data("keyList",g),c.data("nextItem",i),c.empty().append(h),c.scrollTop(0)},_refresh:function(b){var c=a(b.target),d=c.closest("ul"),e=d.data("options"),f=e.checked,g=c.val();if(c.attr("checked"))a.inArray(g,e.checked)===-1&&f.push(g);else{var h=a.inArray(g,f);a.inArray(g,e.checked)>=0&&f.splice(h,1)}a(".multiselect-trigger-container .nr-items").html(f.length),d.data("options",e)},_nextItem:function(a,b){return a.limit&&a.limit<b.length?a.limit:b.length},_checkAll:function(){var b=a(this).parent().siblings("ul"),c=b.data("options");c.checked=b.data("originalKeyList"),a(this).parent().siblings("ul").find(":checkbox").attr("checked",!0).trigger("change")},_uncheckAll:function(){a(this).parent().siblings("ul").data("options").checked=[],a(this).parent().siblings("ul").find(":checkbox").attr("checked",!1).trigger("change")},addItems:function(a){}},a.extend(a.fn,{nexttMultiselect:function(c){if(b.MultiselectController[c])return b.MultiselectController[c].apply(this,Array.prototype.slice.call(arguments,1));if(typeof c=="object"||!c){var d=a.extend(b.MultiselectController.defaultOptions,c);return this.each(function(){b.MultiselectController.init.apply(this,[d])})}a.error("Method "+c+" does not exist on jquery.nextt.multiselect")}})})(jQuery)