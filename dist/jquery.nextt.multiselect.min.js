(function(a){Object.keys=Object.keys||function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if(typeof e!="object"&&typeof e!="function"||e===null)throw new TypeError("Object.keys called on a non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;h<d;h++)a.call(e,c[h])&&f.push(c[h]);return f}}();var b=b||{};b.MultiselectController={init:function(c){var d=a(this).addClass("multiselect"),e=a('<div class="multiselect-trigger-container" />'),f=a('<div class="multiselect-dropdown-container" />'),g=a('<div class="multiselect-action-container" />'),h=a("<ul />"),i=a('<input type="text" class="search-input" />'),j=a('<a href="javascript:void(0)" class="multiselect-checkall-link">Check All</a>'),k=a('<a href="javascript:void(0)" class="multiselect-uncheckall-link">Uncheck All</a>'),l=a('<span class="nr-items" />'),m=a('<span class="items-selected" />');m.append(l," selected"),e.append(m),g.append(i,j,k),f.append(g,h),d.append(e,f),h.data("options",c),b.MultiselectHelper._initializeList(c,h),f.hide(),e.click(function(){f.toggle()}),h.delegate(":checkbox","change",b.MultiselectHelper._refresh),h.bind("scroll",b.MultiselectHelper._scroll),i.bind("keyup",b.MultiselectHelper._search),j.bind("click",b.MultiselectHelper._checkAll),k.bind("click",b.MultiselectHelper._uncheckAll)},options:function(c){if(c){var d=a(this).find(".multiselect-dropdown-container ul"),e=d.data("options");a.extend(e,c),b.MultiselectHelper._initializeList(e,d)}}},b.MultiselectHelper={_initializeList:function(a,c){b.MultiselectHelper._initializeItems(a,c),b.MultiselectHelper._initializeChecked(a,c),b.MultiselectHelper._updateCheckedCounter(c)},_initializeItems:function(a,c){if(a.items){if(typeof a.items!="object")throw"Nextt Multiselect - Invalid initialization params - items should be a map";var d=Object.keys(a.items),e=b.MultiselectHelper._nextItem(a,d);c.data("nextItem",e),c.data("keyList",d),c.data("originalKeyList",d),c.empty(),b.MultiselectHelper._renderChunk(c,0,d,a)}else c.append('<li class="multiselect-empty-msg">No items to show</li>')},_initializeChecked:function(b,c){if(b){var d=c.data("keyList"),e=b.checked||[],f=a.map(e,function(b,c){if(a.inArray(b,d)>=0)return b});b.checked=f}},_scroll:function(){var c=a(this);if(c[0].scrollHeight-c.scrollTop()>500)return;var d=c.data("nextItem"),e=c.data("options"),f=c.data("keyList");if(e&&e.limit&&d<f.length){var g=d+e.limit;b.MultiselectHelper._renderChunk(c,d,f,e),c.data("nextItem",g)}},_renderChunk:function(b,c,d,e){var f=null,g=d.length-c;e.limit?f=e.limit>g?g:e.limit:f=d.length;var h="";for(var i=c;i<c+f;i++){var j="";a.inArray(d[i],e.checked)>=0&&(j=' checked="checked"'),h+='<li><label><input type="checkbox" value="'+d[i]+'" '+j+"/>"+e.items[d[i]]+"</label></li>"}b.append(h)},_search:function(){var c=a(this).parent().siblings("ul"),d=c.data("options"),e=a(this).val(),f=new RegExp(e,"i"),g=a.map(d.items,function(a,b){if(f.test(a))return b}),h=b.MultiselectHelper._nextItem(d,g);c.data("keyList",g),c.data("nextItem",h),c.empty(),b.MultiselectHelper._renderChunk(c,0,g,d),c.scrollTop(0)},_refresh:function(c){var d=a(c.target),e=d.closest("ul"),f=e.data("options"),g=f.checked,h=d.val();if(d.attr("checked"))a.inArray(h,f.checked)===-1&&g.push(h);else{var i=a.inArray(h,g);a.inArray(h,f.checked)>=0&&g.splice(i,1)}b.MultiselectHelper._updateCheckedCounter(e)},_updateCheckedCounter:function(a){var b=a.data("options").checked.length;a.parent().siblings(".multiselect-trigger-container").find(".nr-items").html(b)},_nextItem:function(a,b){return a.limit&&a.limit<b.length?a.limit:b.length},_checkAll:function(){var b=a(this).parent().siblings("ul"),c=b.data("options");c.checked=b.data("originalKeyList"),a(this).parent().siblings("ul").find(":checkbox").attr("checked",!0).trigger("change")},_uncheckAll:function(){var b=a(this).parent().siblings("ul");b.data("options").checked=[],b.find(":checkbox").attr("checked",!1).trigger("change")}},a.extend(a.fn,{nexttMultiselect:function(c){if(b.MultiselectController[c])return b.MultiselectController[c].apply(this,Array.prototype.slice.call(arguments,1));if(typeof c=="object"||!c){var d=a.extend(b.MultiselectController.defaultOptions,c);return this.each(function(){b.MultiselectController.init.apply(this,[d])})}a.error("Method "+c+" does not exist on jquery.nextt.multiselect")}})})(jQuery)